---
title: "ACNP 2024 MS ANXIETY"
author: "Erica Baller"
date: "7/1/2024"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(visreg)
library(lme4)
library(lmerTest)
library(ggplot2)
library(reshape2)
library(pwr)
library(mgcv)
library(stringr)
library(MatchIt)
library(ggpubr)
library(tidymv)
#functions
source("~/BBL/msanxiety/scripts/ms_functions.R")
```

## MS anxiety analyses

## R Markdown

The first chunk here is reading in appropriate data frames and preprocessing. Two big data frames are read in. The first is the demographic, drug, lab info for the MS patients (from the DAC pull). The second is the data frame of fascicle proportion affected for people with good mimosa (# volume affected/total volume of fascicle). The most important preprocessing occurs in a series of mutate commands. These essentially add new columns to the data frame that can later be used. The thrust of these mutate commands is to define who has depression and who does not.

Of note, in prior iterations of this analysis, we did not consider psychiatric medications in determining group inclusion/exclusion. Turns out it makes a difference, as a lot of people on psychotropic medications were counted as "controls/healthy" in previous analyses. For these preliminary analysis, our inclusion/exclusion are more stringent. Of note, the graph below is irrespective of whether they had good/bad MIMoSA. As such, the MIMoSA subset is smaller. It does however highlight the

<img width="70%" src="/Users/eballer/BBL/msdepression/data/drugs_data/MS_Patient_Depression_Categorizations.png"/>


Inclusion criteria below:

Inclusion MS Criteria (dataframe read in here has already been filtered down using the exclusions below previously)
  1) Scanned under MS protocol (42K)
  2) MS Diagnosis (17K)
  3) Seen by MS doctor (16K)
  
Inclusion criteria for Anxious Group
  1) Have an ICD10 F4* code (in our sample, people have F41.1; 41.3; 41.8; 41.9)
        (may use this later)- https://www.nami.org/About-Mental-Illness/Treatments/Mental-Health-Medications
        
Inclusion criteria for Healthy Group
  1) No F* diagnoses
  2) At least 1 PHQ2 or PHQ9 with a documented 0
  3) Free of psychiatric medications per NAMI website (plus editions per Dr. Baller)

Exclusions
  If you received the MS protocol or had a diagnosis of MS but never actually saw an MS provider, we cannot be sure that the diagnosis of MS is truly valid, as it is hard to diagnose anyway.
  If you did not have a diagnosis of depression and never completed a PHQ2 or 9, and had no history of medications, we could not safely confirm nor deny the presence of anxiety. These subjects were excluded from future analyses. We could consider adding these to the healthy group maybe, but not too inclined to do that right now. 

Imaging exclusion
  We are currently only using people who had good MIMOSA (75 or 100). That severely limits our numbers, but that is okay! When we re-QC, we will probably get a lot more into this group.

Final N demographics 

  
(unique, with good MIMoSA):



### testing mean UF in depression group  - NS!!!
(previous script (~/BBL/msdepression/scripts/Biological_Psychiatry_Revision_Scripts/msdepression_n380_started_20230927_mm_BP_r1.Rmd)), lines 734 and  779-781
  #bilat: depGroupVar        85.32     206.70   t=0.413    p=0.680    
  disease_mean_UF_vol_lm <- lm(mean_UF_vol ~ depGroupVar + osex+PAT_AGE_AT_EXAM, data = dep_and_healthy_groups_for_ICD_analysis)
  summary(disease_mean_UF_vol_lm)
#findings


```{r read_in_df}
homedir <- "/Users/eballer/BBL/msanxiety/"

#open Rds
data_2023_pull <- readRDS(paste0(homedir, "/data/data_2023_pull_with_curated_icd10_codes.rds"))
```

```{r read_in_mimosa_qc}
#This section checks how many unique individuals had QA data, and then how many met MIMoSA QC. Some additional people lost at registration. 

#1 Total unique individuals who also have MS - 890
#2 Total unique who had good MIMoSA - 786
#3 Total unique with bad MIMoSA - 890-786 = 104
#4 Total lost in streamline filtering - 3
#5 Final N going into inclusion/exclusion - 783

#read in mimosa data
mimosa_qc <- read.csv("/Users/eballer/BBL/msdepression/data/melissa_martin_files/csv/mimosa_dataframe", sep = ",", header = FALSE) #n=2840

#preprocess data frame to extract dates, empis, and score
empis_with_qc <- mimosa_qc %>% 
  mutate(EMPI = as.factor(gsub(x = V5, pattern = ".*sub-(.*)/ses-.*/.*", replacement="\\1", perl = TRUE))) %>%
  mutate(EXAM_DATE = gsub(x=V5, pattern = ".*/ses-(.{8})/.*", replacement = "\\1\\2\\3")) %>% 
  mutate(score = V3) 

#merge with whole data frame to make sure we exclude people w/out MS
mimosa_qc_df <- merge(data_2023_pull, empis_with_qc, by = c("EMPI", "EXAM_DATE")) #n = 3592

#get list of unique patients, n = 890
mimosa_qc_unique <- mimosa_qc_df %>%
  group_by(EMPI) %>%
  arrange(EXAM_DATE) %>%
  slice(1) %>%
  ungroup #n=890
  
#get list of unique patients with good QC, n = 867
mimosa_unique_score_gre_75 <- mimosa_qc_unique %>%
  filter(score >= 75) %>%
  group_by(EMPI) %>%
  arrange(EXAM_DATE) %>%
  mutate(EXAM_DATA = as.character(EXAM_DATE)) %>%
  mutate(EMPI = as.character(EMPI)) %>%
  dplyr::select(EMPI, EXAM_DATE, score) %>%
  slice(1) %>%
  ungroup 
```

```{r merge_df_with_mimosa}

#n=867, individual scans
df_people_with_good_mimosa <- data_2023_pull %>% 
  group_by(EMPI, EXAM_DATE) %>%
  slice(1) %>%
  left_join(mimosa_unique_score_gre_75, by = c("EMPI", "EXAM_DATE")) %>%
  filter(!is.na(score))
```



### Read in fascicle info, use this to determine proportion and volume of injury within each fascicle, and save it in the df_demo_and_fascicles_df
```{r read_in_fascicle_info}

### by the end of this chunk, the df should include 77 columns each for proportion of injury and volume of injury in each fascicle

##########################################################
#             Read in Fascicle info             #
##########################################################

fascicle_proportions <- read.csv(paste0("/Users/eballer/BBL/msdepression//results/fascicle_volumes_all_subjects_roi_n2336.csv"), header = T, sep = ",") #n = 2336
fascicle_proportions <- fascicle_proportions %>%
  mutate(EMPI = as.character(EMPI)) %>%
  mutate(EXAM_DATE = as.character(EXAM_DATE))

```

## Merge data with good mimosa
```{r merge_with_good_mimosa}
##########################################################
#             Merge with data_empi              #
##########################################################

 #n = 812
df_demo_and_fascicles <- df_people_with_good_mimosa %>% 
  left_join(fascicle_proportions, by = c("EMPI", "EXAM_DATE")) %>%
  filter(!is.na(Has.MS.Provider)) %>% #remove people who don't have MS provider
  filter(!is.na(CNII_L)) #this is a sample fascicle that should have a value. if it does not, it means something is usually wrong with whole person. Remove rows with NAs


```

## Read in lesion volume size
```{r read_in_lesion_volumes}
##########################################################
#             Read in Lesion Volumes                     #
##########################################################

# contains the volume of lesioned voxels, i.e. a sum of all the areas of each individual's binary mask that are 1

lesion_volumes <- read.csv("/Users/eballer/BBL/msdepression/results/mimosa_binary_masks_hcp_space_20211026_n2336_volumes", sep = ",", header = TRUE) #n=958 unique, identical to fascicle unique
lesion_volumes <- lesion_volumes %>%
  mutate(EMPI = as.character(EMPI)) %>%
  mutate(EXAM_DATE = as.character(EXAM_DATE))

```

## Merge with data frame with good mimosas
```{r merge_lesion_volume_w_mimosa_df}
##########################################################
#             Merge lesion volumes with mimosa df        #
##########################################################
#merge whole data set with fascicle proportions, n = 812
df_demo_and_fascicles <- df_demo_and_fascicles %>%
  left_join(lesion_volumes, by = c("EMPI", "EXAM_DATE")) 


```

## Make separate columns for proportional injury (prop), total volume injury (vol)
```{r add_suffix_to_each_measure}

########################################
## Read in Fiber Volume Values        ##
########################################

#read in fiber volume values
fiber_volume_values <- read.csv("/Users/eballer/BBL/msdepression/templates/dti/HCP_YA1065_tractography/fiber_volume_values.csv", sep=",", header = T)


#########################################
## Get vectors with names of fascicles ##
#########################################

#fascicle names are contained in all but the first 2 columns of the fascicle_proportions df
fascicle_names <- names(fascicle_proportions[3:dim(fascicle_proportions)[2]])
fascicle_names_no_cranial_nerves <- fascicle_names[grep("CN", fascicle_names, invert = TRUE)] #n=77, drop cranial nerves

fascicle_names_w_prop_suffix <- gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE, x = fascicle_names_no_cranial_nerves)
fascicle_names_w_vol_suffix <- gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE, x = fascicle_names_no_cranial_nerves)


#write.table(fascicle_names,"/Users/eballer/BBL/msdepression/templates/dti/HCP_YA1065_tractography/fascicle_names.csv", row.names = F, quote = F, col.names = F)


##########################################################
#  Add columns for volume and change proportion names    #
##########################################################


#remove cranial nerves
fiber_volume_values_no_cranial_nerves <- fiber_volume_values %>% filter(fascicle %in% fascicle_names_no_cranial_nerves) %>%
  slice(order(factor(fascicle, levels = fascicle_names_no_cranial_nerves)))


#extract data frame that only includes the fascicle proportion lost
df_fascicles_prop <- df_demo_and_fascicles[ , (names(df_demo_and_fascicles) %in% fascicle_names_no_cranial_nerves)] 
df_everything_else <- df_demo_and_fascicles[ , !(names(df_demo_and_fascicles) %in% fascicle_names_no_cranial_nerves)]

#multiply each row by the vector of total volumes to extract volume of disease within fascicle
df_fascicles_volumes <- sweep(x = df_fascicles_prop, MARGIN = 2,                        # Sweep with Complex STATS
                  STATS = fiber_volume_values_no_cranial_nerves$volume_full, FUN = "*") %>%
  mutate_if(is.numeric, round) #round all values

# change name of df_fascicle_volumes to have the suffix, and add a suffix for the proportion measures
names(df_fascicles_prop) <- fascicle_names_w_prop_suffix
names(df_fascicles_volumes) <- fascicle_names_w_vol_suffix


#combine back with data_fram
#df_demo_and_fascicle_volumes_full <- cbind(df_everything_else, df_fascicle_volumes)
df_demo_and_fascicles <- cbind(df_everything_else, df_fascicles_prop, df_fascicles_volumes)
```

##YEO Networks
###Read in fascicle info
```{r read_in_yeo_fascicle_info}
##########################################################
#             Read in Fascicle info             #
##########################################################
########
#fascicle volumes in yeo networks
########

#read in file with proportions
#fascicle_volumes_yeo_7 <- read.csv(paste0(homedir, "results/yeo_7_network_overlap_proportions.txt"), header = T, sep = ",", na.strings="0")

#make titles nice
#names(fascicle_volumes_yeo_7) <-gsub("prop_in_mask_", "prop_", names(fascicle_volumes_yeo_7))

#make Nas into 0
#fascicle_volumes_yeo_7[is.na(fascicle_volumes_yeo_7)]=0

#read in file with binarized yes/no 
fascicle_volumes_yeo_7_binarized <- read.csv("/Users/eballer/BBL/msdepression/results/yeo_7_network_overlap_proportions_binarized.txt", header = T, sep = ",")

#drop cranial nerves
fascicle_volumes_yeo_7_binarized_no_cranial_nerves <- fascicle_volumes_yeo_7_binarized %>% filter(!grepl('CN', fascicle))

#check that order of df is same as yeo networks
new_df <- gsub(pattern = "_vol", replacement = "", x = names(df_demo_and_fascicles[grep(pattern = "_vol", x = names(df_demo_and_fascicles))]))

combined_df <- data.frame(cbind(new_df, fascicle_volumes_yeo_7_binarized_no_cranial_nerves$fascicle))
names(combined_df) <- c("df", "yeo")

#they match
combined_df$match <- combined_df$df == combined_df$yeo
```

### Calc healthy volume of yeo networks
```{r calc_healthy_volume_of_yeo_networks}
#multiply with the binary yeo maps to get absolute volumes of healthy
fascicle_volumes_yeo_7_full_volumes <- fascicle_volumes_yeo_7_binarized_no_cranial_nerves %>% 
  tibble::remove_rownames() %>%
  tibble::column_to_rownames(var = 'fascicle') %>%
  mutate(across(everything()) * fiber_volume_values_no_cranial_nerves$volume_full) %>%
  rename_with(~ str_c(.x, "_vol"), everything()) 

#sum the volumes of each network to get total. 
sums_of_volume_of_healthy_fascicles_by_network <- fascicle_volumes_yeo_7_full_volumes %>%
  summarise(across(everything(), ~ sum(., na.rm = TRUE)))

```

###Calculate injury to yeo networks for each subject
```{r calculate_injury_to_network}

#grab names of networks, get rid of first element which is "fasiscle"
yeo_network_names <- names(fascicle_volumes_yeo_7_binarized_no_cranial_nerves)[-1] 

#make names with _prop_net for use later to grap columns of proportions and not volumes
yeo_network_names_prop <- paste(yeo_network_names, 'prop_net', sep = '_')

df_w_yeo_volume_info <- df_demo_and_fascicles %>%
  # mutate(total_fascicle_vol_lost = rowMeans(across(all_of(fascicle_names_w_vol_suffix)))) %>%
  dplyr::select(EMPI, ends_with("_vol")) %>%
  ungroup()

#add columns to data frame for each network
df_w_yeo_volume_info[,yeo_network_names] = 0

#this has been checked with eyeballs and works. You CAN trust the df_w_yeo_volume_info
for (network in yeo_network_names) {

  for (subj in 1:dim(df_w_yeo_volume_info)[1]) {
      # multiply the binary vector of the network with the fascicle volumes of injury, sum, and store in data frame
      text_to_eval <- paste0("df_w_yeo_volume_info$", network,"[", subj,"]=sum(fascicle_volumes_yeo_7_binarized_no_cranial_nerves$", network,
      "*df_w_yeo_volume_info[",subj,",3:(dim(df_w_yeo_volume_info)[2] - 7)])")
     # print(text_to_eval)
      eval(parse(text=text_to_eval))
  }
}

### going to add 7 more columns to the data frame that contain the volume of injury/total healthy volume
df_w_yeo_volume_info_with_prop_of_network <- tibble(df_w_yeo_volume_info) %>% 
  mutate(across(all_of(yeo_network_names), 
    .names = "{.col}_prop_net"
    
  ))

#go through each subject, and divide their total volume of injury within each network by the overall volume of the network
for (subj in 1:dim(df_w_yeo_volume_info_with_prop_of_network)[1]){
  df_w_yeo_volume_info_with_prop_of_network[subj, grepl(x = names(df_w_yeo_volume_info_with_prop_of_network), pattern = "_prop_net")] = df_w_yeo_volume_info_with_prop_of_network[subj, grepl(x = names(df_w_yeo_volume_info_with_prop_of_network), pattern = "_prop_net")]/sums_of_volume_of_healthy_fascicles_by_network
}

### rename the whole new data frame df_demo_and_fascicles
df_demo_and_fascicles <- df_w_yeo_volume_info_with_prop_of_network %>% 
  dplyr::select(-contains('_vol')) %>% #removes all columns with volume, leaving only the exam date, empi, and yeo values
  right_join(df_demo_and_fascicles, by = c("EXAM_DATE", "EMPI")) #combine with demo_and_fascicles

  

```
##Anxiety Network from neurosynth (association, not uniformity)
###read in file with fasciclexanxiety overlap, and define anxiety network
```{r read_in_neurosynth_anxiety_network}
neurosynth_anxiety_network_fascicle_overlap <- read.csv("/Users/eballer/BBL/msanxiety/results/streamline_volume_within_anxiety_network_association_neuro_maps_FDR_01.csv", header = T, sep = ",") %>% 
  filter(fascicle %in% fascicle_names_no_cranial_nerves) %>%
  slice(order(factor(fascicle, levels = fascicle_names_no_cranial_nerves))) %>% #get rid of cranial nerves up front 
  replace(is.na(.), 0)

fascicles_with_any_anxiety_overlap <- neurosynth_anxiety_network_fascicle_overlap %>%
  filter(prop_in_mask > 0)  #n = 43

#top 25% 
#number_of_brain_regions_in_top_25 <- round((dim(fascicles_with_any_anxiety_overlap)[1]/4)) #n=11
number_of_brain_regions_in_top_25 <- round((dim(neurosynth_anxiety_network_fascicle_overlap)[1]/4)) #n=19

fascicles_with_vol_top_25_percent_anxiety_overlap <- neurosynth_anxiety_network_fascicle_overlap %>%
  filter(!is.na(prop_in_mask)) %>%
  arrange(desc(non_zero_voxels_in_anxiety_map)) %>%
  slice(1:number_of_brain_regions_in_top_25)
  
fascicles_with_prop_top_25_percent_anxiety_overlap <- neurosynth_anxiety_network_fascicle_overlap %>%
  filter(!is.na(prop_in_mask)) %>%
  arrange(desc(prop_in_mask)) %>%
  slice(1:number_of_brain_regions_in_top_25)


#name vectors to use later
fascicle_names_any_anxiety_overlap_vol <- fascicles_with_any_anxiety_overlap$fascicle 
fascicle_names_top_25_vol <- fascicles_with_vol_top_25_percent_anxiety_overlap$fascicle 
fascicle_names_bottom_75_vol <- neurosynth_anxiety_network_fascicle_overlap %>% filter(!(fascicle %in% fascicle_names_top_25_vol)) %>% pull(fascicle)

fascicle_names_any_anxiety_overlap_prop <- fascicles_with_any_anxiety_overlap$fascicle
fascicle_names_top_25_prop <-fascicles_with_prop_top_25_percent_anxiety_overlap$fascicle 
fascicle_names_bottom_75_prop <- neurosynth_anxiety_network_fascicle_overlap %>% filter(!(fascicle %in% fascicle_names_top_25_prop)) %>% pull(fascicle)

##add vol/prop
fascicle_names_any_anxiety_overlap_vol_w_suff <- fascicle_names_any_anxiety_overlap_vol %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)
fascicle_names_top_25_vol_w_suff <- fascicle_names_top_25_vol %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)
fascicle_names_bottom_75_vol_w_suff <- fascicle_names_bottom_75_vol  %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 

fascicle_names_any_anxiety_overlap_prop_w_suff <- fascicle_names_any_anxiety_overlap_prop %>% gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE)
fascicle_names_top_25_prop_w_suff <- fascicle_names_top_25_prop %>% gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE)
fascicle_names_bottom_75_prop_w_suff <- fascicle_names_bottom_75_prop %>% gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE) 


# Total volume of injury within each anxiety network, double checked that : top_25_total_volume + bottom_75_total_volume
total_fascicle_volume <- sum(neurosynth_anxiety_network_fascicle_overlap$num_voxels_total)
any_anxiety_overlap_total_volume <- sum(fascicles_with_any_anxiety_overlap$num_voxels_total) # vol = 1093606
top_25_total_volume <-sum(fascicles_with_vol_top_25_percent_anxiety_overlap$num_voxels_total) # vol = 548305
bottom_75_total_volume <- sum(neurosynth_anxiety_network_fascicle_overlap$num_voxels_total[neurosynth_anxiety_network_fascicle_overlap$fascicle %in% fascicle_names_bottom_75_vol]) #vol = 548305

### Sort all the fascicles by %overlap, in decreasing order (so highest overlap at the top), and then take names of the top quartile, save for making binary maps later
anxiety_network_names_top_quartile_no_cranial_nerves<- (neurosynth_anxiety_network_fascicle_overlap[order(neurosynth_anxiety_network_fascicle_overlap$non_zero_voxels_in_anxiety_map, decreasing = TRUE),])$fascicle[1:number_of_brain_regions_in_top_25] 

write.table(anxiety_network_names_top_quartile_no_cranial_nerves, paste0(homedir, "/results/anxiety_network_names_top_quartile_no_cranial_nerves_by_vol.txt"), row.names = F, col.names = F, quote = F)

df_for_making_binary_color_maps_vol <- neurosynth_anxiety_network_fascicle_overlap %>% dplyr::select(fascicle, non_zero_voxels_in_anxiety_map)

write.table(df_for_making_binary_color_maps_vol, paste0(homedir, "/results/volume_of_overlap_w_anxiety_net_n77.csv"), row.names = F, col.names = F, quote = F, sep = ",")

df_for_making_binary_color_maps_prop <- neurosynth_anxiety_network_fascicle_overlap %>% dplyr::select(fascicle, prop_in_mask)

write.table(df_for_making_binary_color_maps_prop, paste0(homedir, "/results/proportion_of_overlap_w_anxiety_net_n77.csv"), row.names = F, col.names = F, quote = F, sep = ",")

```

### Get dep network data
```{r depression_network_injury}
#take depression network from the BP paper, and find names of fascicles in each group

#read in depression network overlap by volume data frame
dep_net_overlap_from_bp_paper <- read.csv("/Users/eballer/BBL/msdepression/results/df_fascicles_sorted_by_volume_in_mask_for_eTable3.csv", sep = ",", header = TRUE)

dep_net_top_25_percent <- dep_net_overlap_from_bp_paper$fascicle[1:round((dim(dep_net_overlap_from_bp_paper)[1]/4),0)]
dep_net_top_25_percent_w_suff <- dep_net_top_25_percent %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)

top_25_total_volume_dep <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[1:round((dim(dep_net_overlap_from_bp_paper)[1]/4),0)])

nondep_net_bottom_75_percent <- dep_net_overlap_from_bp_paper$fascicle[(round(dim(dep_net_overlap_from_bp_paper)[1]/4,0) +1):dim(dep_net_overlap_from_bp_paper)[1]]
nondep_net_bottom_75_percent_w_suff <- nondep_net_bottom_75_percent %>%gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)

bottom_75_total_volume_nondep <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[(round(dim(dep_net_overlap_from_bp_paper)[1]/4,0) +1):dim(dep_net_overlap_from_bp_paper)[1]])

```

### find names of fascicles in anxiety + dep network, unique to dep net, and unique to anxiety net
```{r find_names_and_overlaps_of_dep_and_anxiety_networks}

#I want to figure out what the volume is in all voxels within the overlap of depression and anxiety network, as well as within the nonoverlapping networks
#the depression net overlap from bp paper contains a colum (num_voxels_total) that has the full voxel sizes of all of the fascicles. Will use this to help find the "total volume size"

#total volume = 1545449
#checked to make sure that dep_only_net_vol + anxiety_only_net_vol + dep_and_anxiety_net_overlap_net_volume = dep_and_anxiety_net_unique_net_volume

dep_and_anxiety_combined <- c(fascicle_names_top_25_vol, dep_net_top_25_percent) #n = 38

dep_and_anxiety_net_unique_names <- dep_and_anxiety_combined %>% unique() #n=34
dep_and_anxiety_net_unique_net_volume <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% dep_and_anxiety_net_unique_names]) #vol = 1048643

dep_and_anxiety_net_overlap_names <- dep_and_anxiety_combined[dep_and_anxiety_combined %>% duplicated()] #n=4
dep_and_anxiety_net_overlap_net_volume <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% dep_and_anxiety_net_overlap_names]) #vol = 486260

dep_and_anxiety_net_overlap_names_no_CC <- dep_and_anxiety_net_overlap_names[dep_and_anxiety_net_overlap_names != "CC"]
dep_and_anxiety_net_overlap_net_volume_no_CC <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% dep_and_anxiety_net_overlap_names_no_CC]) #vol = 95659

dep_only_names <- dep_and_anxiety_net_unique_names[!(dep_and_anxiety_net_unique_names %in% fascicle_names_top_25_vol)] #n=15
dep_only_net_vol <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% dep_only_names]) #vol = 370747

anxiety_only_names <-dep_and_anxiety_net_unique_names[!(dep_and_anxiety_net_unique_names %in% dep_net_top_25_percent)] #n=15
anxiety_only_net_vol <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% anxiety_only_names]) #vol = 191636

### add suffix
dep_and_anxiety_net_unique_names_w_suff <- dep_and_anxiety_net_unique_names  %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 

dep_and_anxiety_net_overlap_names_w_suff <- dep_and_anxiety_net_overlap_names %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 

dep_and_anxiety_net_overlap_names_w_suff_no_CC <- dep_and_anxiety_net_overlap_names_no_CC %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 

dep_only_names_w_suff <- dep_only_names %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 

anxiety_only_names_w_suff <- anxiety_only_names %>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE) #take fascicles not in 
```

### Define anxiety net by top 25 in both vol/prop
```{r defineanxietynet_with_25_propx25vol}
##### make an array of fascicles that have both substantial overlap with the anxiety network (top 25% vol), and where each fascicle is substantially impacted (top 25% proportion), n = 14
fascicle_names_top_25_vol_x_top_25_prop <- fascicle_names_top_25_vol[fascicle_names_top_25_vol %in% fascicle_names_top_25_prop]

#add vol/prop suffixes
fascicle_names_top_25_vol_x_top_25_prop_PROP_suffix <-fascicle_names_top_25_vol_x_top_25_prop%>% gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE)
fascicle_names_top_25_vol_x_top_25_prop_VOL_suffix <-fascicle_names_top_25_vol_x_top_25_prop%>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)

#create fascicle vectors that don't include these special fascicles, n = 63
fascicle_names_NOT_top_25_vol_x_top_25_prop <- fascicle_names_no_cranial_nerves[!(fascicle_names_no_cranial_nerves %in% fascicle_names_top_25_vol_x_top_25_prop)]

#add vol/prop suffixes
fascicle_names_NOT_top_25_vol_x_top_25_prop_PROP_suffix <- fascicle_names_NOT_top_25_vol_x_top_25_prop%>% gsub(pattern = "(.*)", replacement = "\\1_prop", perl=TRUE)
fascicle_names_NOT_top_25_vol_x_top_25_prop_VOL_suffix <- fascicle_names_NOT_top_25_vol_x_top_25_prop%>% gsub(pattern = "(.*)", replacement = "\\1_vol", perl=TRUE)

#anxiety25_propxvol overlap total, sum of these two is 1545449 (and this is total_fascicle_volume)
anxiety_top_25_vol_x_top_25_prop_vol <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% fascicle_names_top_25_vol_x_top_25_prop]) #vol = 181869

#nonanxiety25_propxvol overlap total
anxiety_NOT_top_25_vol_x_top_25_prop_vol <- sum(dep_net_overlap_from_bp_paper$num_voxels_total[dep_net_overlap_from_bp_paper$fascicle %in% fascicle_names_NOT_top_25_vol_x_top_25_prop]) #vol = 1363580

#check sums
if ((anxiety_top_25_vol_x_top_25_prop_vol + anxiety_NOT_top_25_vol_x_top_25_prop_vol) == total_fascicle_volume) {
  print("anxiety + nonanxiety net = total fascicle volume")
} else{
  print("something is wrong with counts")
}
  
```

###Add columns in the main data frame indicating overall injury in the whole network, in the top 25 network (vol and prop), and bottom 75%
```{r add_anxiety_and_dep_network_details_to_data_frame}

#all of this has been checked - making sure prop * vol network = sum of damage

df_demo_and_fascicles <- df_demo_and_fascicles %>%
  
  
  mutate(mean_fascicle_prop_lost_no_cranial_nerves = rowMeans(across(all_of(fascicle_names_w_prop_suffix)))) %>%
  mutate(mean_fascicle_volume_lost_no_cranial_nerves = rowMeans(across(all_of(fascicle_names_w_vol_suffix)))) %>%

  #sum of total volume lost and proportion of volume lost 
  mutate(sum_fascicle_vol_lost = rowSums(across(all_of(fascicle_names_w_vol_suffix)))) %>%
  mutate(proportion_volume_lost_per_total_network_size_sum = sum_fascicle_vol_lost/total_fascicle_volume) %>%
  
  #sum of total volume lost in anxiety network and proportion of volume lost in anxiety network (volume lost/network volume size) 
  mutate(sum_fascicle_vol_lost_inanxietynet_all = 
           rowSums(across(all_of(fascicle_names_any_anxiety_overlap_vol_w_suff)))) %>%
  mutate(proportion_volume_lost_anxiety_net_by_network_size_sum = sum_fascicle_vol_lost_inanxietynet_all/any_anxiety_overlap_total_volume) %>%
 
  
  #sum of total volume lost in anxiety network and proportion of volume lost in anxiety network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_inanxietynet_top_quartile = 
           rowSums(across(all_of(fascicle_names_top_25_vol_w_suff)))) %>%
  mutate(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 = sum_fascicle_vol_lost_inanxietynet_top_quartile/top_25_total_volume) %>%
 
  #sum of total volume lost in nonanxiety network and proportion of volume lost in anxiety network (volume lost/network volume size) bottom 3 quartiles
  mutate(sum_fascicle_vol_lost_nonanxiety_net_bottom_3_quartiles = 
           rowSums(across(all_of(fascicle_names_bottom_75_vol_w_suff)))) %>%
  mutate(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 = sum_fascicle_vol_lost_nonanxiety_net_bottom_3_quartiles/bottom_75_total_volume) %>%
  
  ##sum of total volume lost in depression network and proportion of volume lost in depression network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_indepressionnet_top_quartile = 
           rowSums(across(all_of(dep_net_top_25_percent_w_suff)))) %>%
  mutate(proportion_volume_lost_depression_net_by_network_size_sum_top_25 = sum_fascicle_vol_lost_indepressionnet_top_quartile/top_25_total_volume_dep) %>%

  #sum of total volume lost in nondepression network and proportion of volume lost in depression network (volume lost/network volume size) bottom 3 quartiles
  mutate(sum_fascicle_vol_lost_nondepression_net_bottom_3_quartiles = 
           rowSums(across(all_of(nondep_net_bottom_75_percent_w_suff)))) %>%
  mutate(proportion_volume_lost_nondepression_net_by_network_size_sum_bottom_75 = sum_fascicle_vol_lost_nondepression_net_bottom_3_quartiles/bottom_75_total_volume_nondep) %>%

  ##sum of total volume lost in depression + anxiety network and proportion of volume lost in network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_indep_and_anxiety_net_combined = 
           rowSums(across(all_of(dep_and_anxiety_net_unique_names_w_suff)))) %>%
  mutate(proportion_fascicle_vol_lost_indep_and_anxiety_net_combined = sum_fascicle_vol_lost_indep_and_anxiety_net_combined/dep_and_anxiety_net_unique_net_volume) %>%
 
  ##sum of total volume lost in areas of overlap between depression + anxiety network and proportion of volume lost in network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_indep_and_anxiety_net_overlap = 
           rowSums(across(all_of(dep_and_anxiety_net_overlap_names_w_suff)))) %>%
  mutate(proportion_fascicle_vol_lost_indep_and_anxiety_net_overlap = sum_fascicle_vol_lost_indep_and_anxiety_net_overlap/dep_and_anxiety_net_overlap_net_volume) %>%
  
  ##sum of total volume lost in areas of overlap between depression + anxiety network and proportion of volume lost in network (volume lost/network volume size), no CC
  mutate(sum_fascicle_vol_lost_indep_and_anxiety_net_overlap_no_CC = 
           rowSums(across(all_of(dep_and_anxiety_net_overlap_names_w_suff_no_CC)))) %>%
  mutate(proportion_fascicle_vol_lost_indep_and_anxiety_net_overlap_no_CC = sum_fascicle_vol_lost_indep_and_anxiety_net_overlap_no_CC/dep_and_anxiety_net_overlap_net_volume_no_CC) %>%
  
  ##sum of total volume lost in depression, no overlap with anxiety network and proportion of volume lost in network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_indepressionnet_no_anxiety_overlap = 
           rowSums(across(all_of(dep_only_names_w_suff)))) %>%
  mutate(proportion_fascicle_vol_lost_indepressionnet_no_anxiety_overlap = sum_fascicle_vol_lost_indepressionnet_no_anxiety_overlap/dep_only_net_vol) %>%
  
    ##sum of total volume lost in anxiety, no depression overlap network and proportion of volume lost in network (volume lost/network volume size) top quartile
  mutate(sum_fascicle_vol_lost_inanxietynet_no_depression_overlap = 
           rowSums(across(all_of(anxiety_only_names_w_suff)))) %>%
  mutate(proportion_fascicle_vol_lost_inanxietynet_no_depression_overlap = sum_fascicle_vol_lost_inanxietynet_no_depression_overlap/anxiety_only_net_vol) %>%
  
    ##sum of total volume lost in anxiety 25 volxanxiety25prop groups, and proportion of volume lost in network (volume lost/network volume size)
  mutate(sum_fascicle_names_top_25_vol_x_top_25_prop = 
           rowSums(across(all_of(fascicle_names_top_25_vol_x_top_25_prop_VOL_suffix)))) %>%
  mutate(proportion_fascicle_vol_lost_top_25_vol_x_top_25_prop = sum_fascicle_names_top_25_vol_x_top_25_prop/anxiety_top_25_vol_x_top_25_prop_vol) %>%
  
    ##sum of total volume lost in remaining 63 fascicles NOT in anxiety 25 volxanxiety25prop groups, and proportion of volume lost in network (volume lost/network volume size)
  mutate(sum_fascicle_names_NOT_top_25_vol_x_top_25_prop = 
           rowSums(across(all_of(fascicle_names_NOT_top_25_vol_x_top_25_prop_VOL_suffix)))) %>%
  mutate(proportion_fascicle_vol_lost_NOT_top_25_vol_x_top_25_prop = sum_fascicle_names_NOT_top_25_vol_x_top_25_prop/anxiety_NOT_top_25_vol_x_top_25_prop_vol) %>%
  
   ##mean_uncinate)
  mutate(mean_UF_vol = (UF_L_vol + UF_R_vol)/2) %>%
  mutate(mean_UF_prop = (UF_L_prop + UF_R_prop)/2) %>%
           
  ungroup()   

#neurosynth_anxiety_network_fascicle_overlap
```


#COLLAPSE anxiety dx and antianxiety meds with those plus depression, and anxiety dx OR on anxiety meds into 1 group -->> THIS IS THE MONEY

### Double check that people in each group are correct
```{r gut_check}

#want to make sure that people in healthy are NOT on anxiolytics or have dx, that people in the second group have one OR the other, and that people in the third group have BOTH

#make data frame
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
   filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
   filter (anxiety_dose != 3) 

###true healthy
num_people_in_healthy_with_0_for_Has.Anxiety_and_On.Anxiolytics <- length(which(df_demo_and_fascicles_no_unclass_anxiety_dose$On.Anxiolytics ==0 & df_demo_and_fascicles_no_unclass_anxiety_dose$Has.anxietydx ==0))
print(paste0("num_people_in_healthy_with_0_for_Has.Anxiety_and_On.Anxiolytics-> ", num_people_in_healthy_with_0_for_Has.Anxiety_and_On.Anxiolytics, " and num in this group from groupVar -> ", sum(df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 0)))


### Anxiety dose = 1
num_people_in_Anxiety_OR_On.Anxiolytics <- length(which((df_demo_and_fascicles_no_unclass_anxiety_dose$On.Anxiolytics ==1 | df_demo_and_fascicles_no_unclass_anxiety_dose$Has.anxietydx ==1) &
(df_demo_and_fascicles_no_unclass_anxiety_dose$On.Anxiolytics != df_demo_and_fascicles_no_unclass_anxiety_dose$Has.anxietydx)))

print(paste0("num_people_in_Anxiety_OR_On.Anxiolytics-> ", num_people_in_Anxiety_OR_On.Anxiolytics, " and num in this group from groupVar -> ", sum(df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 1)))

#severe anxiety
num_people_in_Anxiety_AND_Anxiolytics <- length(which(df_demo_and_fascicles_no_unclass_anxiety_dose$On.Anxiolytics ==1 & df_demo_and_fascicles_no_unclass_anxiety_dose$Has.anxietydx ==1))
print(paste0("num_people_in_Anxiety_AND_Anxiolytics-> ", num_people_in_Anxiety_AND_Anxiolytics, " and num in this group from groupVar -> ", sum(df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 2)))

print(paste0("total n -> ",num_people_in_healthy_with_0_for_Has.Anxiety_and_On.Anxiolytics + num_people_in_Anxiety_OR_On.Anxiolytics + num_people_in_Anxiety_AND_Anxiolytics, " and row # in data frame -> ", dim(df_demo_and_fascicles_no_unclass_anxiety_dose)[1]))

```
### Overlap with depression group
```{r overlap_with_dep_group}
#### 53.4% overlap total

#read csv of empis from depression paper
depression_empis <- read.table(file="/Users/eballer/BBL/msanxiety/data/empis_of_people_in_BP_depression_paper.csv")
names(depression_empis) <- "EMPI"

#get final anxiety dataset and make column if the empi is in the prev list
df_disease_burden_unc_and_anx_net_collapsed_variables <- df_demo_and_fascicles %>%
  mutate(EMPI = as.numeric(EMPI)) %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  mutate(EMPI_in_dep_group = EMPI %in% depression_empis$EMPI)

#"Percent overlap 53.4%"
print(paste0("Percent overlap ", round(sum(df_disease_burden_unc_and_anx_net_collapsed_variables$EMPI_in_dep_group)/length(df_disease_burden_unc_and_anx_net_collapsed_variables$EMPI), 3) * 100, "%"))

 tibble_overall_counts <- df_disease_burden_unc_and_anx_net_collapsed_variables %>% 
  group_by(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  summarize(n(),
            num_in_dep_group = sum(EMPI_in_dep_group),
            percent_overlap = num_in_dep_group/n())
 tibble_overall_counts

print(paste0("Percent overlap with depression group -> ", round(sum(tibble_overall_counts$num_in_dep_group)/sum(tibble_overall_counts$`n()`),2)))
```

### Overall Disease by Anxiety Dose *acnp
```{r group_anxietydx_meds_and_dep_comorbidity}
#this collapses anxiety group + meds with those with anxiety group + meds + with/without depression

#demo
make_demographics_table_ms_anxiety_simple(data_frame = df_demo_and_fascicles[df_demo_and_fascicles$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified",])

make_demographics_table_ms_anxiety_simple(data_frame = df_demo_and_fascicles[((df_demo_and_fascicles$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") & (df_demo_and_fascicles$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "Has.Anxietydx.OR.Antianxiety.Meds")),])


df_disease_burden_unc_and_anx_net_collapsed_variables <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>% 
  dplyr::select(proportion_volume_lost_per_total_network_size_sum, proportion_volume_lost_anxiety_net_by_network_size_sum_top_25, proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75, UF_L_prop, UF_R_prop, oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, osex)

 tibble_overall_summaries <- df_disease_burden_unc_and_anx_net_collapsed_variables %>% 
  group_by(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  summarize(n(),
            mean_disease_burden = mean(proportion_volume_lost_per_total_network_size_sum),
            mean_disease_burden_anxiety_net = mean(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25),
            mean_disease_burden_nonanxiety_net = mean(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75),
            mean_UF_L = mean(UF_L_prop),
            mean_UF_R = mean(UF_R_prop))
tibble_overall_summaries 


tibble_overall_summaries_by_sex <- df_disease_burden_unc_and_anx_net_collapsed_variables %>% 
  group_by(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, osex) %>%
  summarize(n(),
            mean_disease_burden = mean(proportion_volume_lost_per_total_network_size_sum),
            mean_disease_burden_anxiety_net = mean(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25),
            mean_disease_burden_nonanxiety_net = mean(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75),
            mean_UF_L = mean(UF_L_prop),
            mean_UF_R = mean(UF_R_prop))
  tibble_overall_summaries_by_sex          

  tibble_overall_summaries_females <- df_disease_burden_unc_and_anx_net_collapsed_variables %>% 
  filter(osex == "Female") %>%
  group_by(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  summarize(n(),
            mean_disease_burden = mean(proportion_volume_lost_per_total_network_size_sum),
            mean_disease_burden_anxiety_net = mean(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25),
            mean_disease_burden_nonanxiety_net = mean(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75),
            mean_UF_L = mean(UF_L_prop),
            mean_UF_R = mean(UF_R_prop))
  tibble_overall_summaries_females  
  
    tibble_overall_summaries_males <- df_disease_burden_unc_and_anx_net_collapsed_variables %>% 
  filter(osex == "Male") %>%
  group_by(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  summarize(n(),
            mean_disease_burden = mean(proportion_volume_lost_per_total_network_size_sum),
            mean_disease_burden_anxiety_net = mean(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25),
            mean_disease_burden_nonanxiety_net = mean(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75),
            mean_UF_L = mean(UF_L_prop),
            mean_UF_R = mean(UF_R_prop))
  tibble_overall_summaries_males  
 
  #mean disease
  
  df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>% filter (anxiety_dose != -1) #-1 is unclassified, 0 is no anxiety, 1 is diagnosis or on meds, 2 is diagnosis AND on meds, -> n = 371
  
  #mean disease by anxiety dose: anxiety_dose    0.047452   0.019130   2.480  0.01357 *  
  anxietyGrouping_mean_disease_lm <- lm(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_disease_lm)
  
  ### gam instead, anxiety_dose  0.04846    0.01901   2.549   0.0112 * 
    anxietyGrouping_mean_disease_gam <- gam(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_disease_gam)
  
  #mean disease with sex in model : anxiety_dose     0.0486229  0.0191648   2.537  0.01159 *  
  anxietyGrouping_by_sex_mean_disease_lm <- lm(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_by_sex_mean_disease_lm)
  
  #gam: anxiety_dose  0.04955    0.01905   2.601  0.00966 **  
      anxietyGrouping_by_sex_mean_disease_gam <- gam(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose + osex+ s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
      summary(anxietyGrouping_by_sex_mean_disease_gam)
```

### Anxiety network by anxiety dose
```{r}

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != -1)
 
  #anxiety network
  
  ###  anxiety_dose   anxiety_dose    0.051190   0.022452   2.280   0.0232 *  
  anxietyGrouping_anxiety_net_lm <- lm(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_anxiety_net_lm)
  
  #gam, anxiety_dose  0.05297    0.02248   2.357    0.019 *  
   anxietyGrouping_anxiety_net_gam<- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_anxiety_net_gam)
  
  #volume lost in anxiety net by anxiety dose*sex: anxiety_dose         0.066699   0.026574   2.510   0.0125 *  , no intx
  anxietyGrouping_by_sex_anxiety_net_lm <- lm(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose*osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_by_sex_anxiety_net_lm)
  
  #gam, anxiety_dose         0.06708    0.02648   2.533   0.0117 *   
  anxietyGrouping_by_sex_anxiety_net_gam <- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose*osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_by_sex_anxiety_net_gam)
  
  #volume lost in anxiety net by anxiety dose + sex + PAT_AGE_AT_EXAM: anxiety_dose     0.052228   0.022506   2.321   0.0209 *  
  anxietyGrouping_cov_sex_anxiety_net_lm <- lm(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_cov_sex_anxiety_net_lm)
  
  #gam, anxiety_dose  0.05256    0.02244   2.342   0.0197 *  
   anxietyGrouping_cov_sex_anxiety_net_gam <- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_cov_sex_anxiety_net_gam)
  
  
```

### NonAnxiety network by anxiety dose
```{r}

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != -1)
 
  #anxiety network
  
  ###  anxiety_dose: anxiety_dose    0.0445315  0.0172621   2.580   0.0103 * 
  anxietyGrouping_nonanxiety_net_lm <- lm(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_nonanxiety_net_lm)
  
  #gam, anxiety_dose  , anxiety_dose  0.04741    0.01712   2.769   0.0059 ** 
   anxietyGrouping_nonanxiety_net_gam<- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_nonanxiety_net_gam)
  
  #volume lost in anxiety net by anxiety dose*sex: anxiety_dose         0.059732   0.020184   2.959  0.00328 ** 
  anxietyGrouping_by_sex_nonanxiety_net_lm <- lm(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose*osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_by_sex_nonanxiety_net_lm)
  
  #gam, anxiety_dose, anxiety_dose         0.047100   0.016230   2.902  0.00393 **          
  anxietyGrouping_by_sex_nonanxiety_net_gam <- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose*osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_by_sex_nonanxiety_net_gam)
  
  #volume lost in anxiety net by anxiety dose + sex + PAT_AGE_AT_EXAM: anxiety_dose     0.0458062  0.0172824   2.650  0.00839 ** 
  anxietyGrouping_cov_sex_nonanxiety_net_lm <- lm(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_cov_sex_nonanxiety_net_lm)
  
  #gam, anxiety_dose - anxiety_dose  0.04861    0.01714   2.836  0.00483 ** 
   anxietyGrouping_cov_sex_nonanxiety_net_gam <- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_cov_sex_nonanxiety_net_gam)
  
  
```

### Lesion volumes 
#### Diagnosis 
  - sick > healthy in vol of lesions
```{r lesion_volumes_dx}
 df_empi_dx_network_proportions <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "Has.Anxietydx.OR.Antianxiety.Meds") %>%
  mutate(subject = as.factor(EMPI)) %>%
  mutate(Diagnosis = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  mutate(Diagnosis = ifelse(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy", "MS-Anxiety", "MS+Anxiety")) %>%
  mutate(Diagnosis = as.factor(Diagnosis)) %>%
  dplyr::select(subject, osex, Diagnosis, PAT_AGE_AT_EXAM, volume_of_mimosa_lesions) %>%
  ungroup() #n=122
 
##### healthy vs sick

#lm lesion volumes; DiagnosisMS+Anxiety  9210.15    2966.03   3.105 0.002381 ** 
volume_of_mimosa_lesions_lm <- lm(volume_of_mimosa_lesions ~ Diagnosis + osex + PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(volume_of_mimosa_lesions_lm)

#gam lesion volumes; DiagnosisMS+Anxiety   8765.2     2748.2   3.189  0.00183 ** 
volume_of_mimosa_lesions_gam <- gam(volume_of_mimosa_lesions ~ Diagnosis + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data = df_empi_dx_network_proportions)
summary(volume_of_mimosa_lesions_gam)
```

#### Anxiety dose
  - anxiety dose correlates with disease burden (volume of lesions)
```{r lesion_volumes_anxiety_dose}
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != -1) #n=371

#dose; anxiety_dose     3562.72    1299.08   2.743 0.006396 *

  anxiety_dose_volume_of_mimosa_lesions_by_sex_lm <- lm(volume_of_mimosa_lesions ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxiety_dose_volume_of_mimosa_lesions_by_sex_lm)
  
 #bilat anxiety dose + sex + age: anxiety_dose     3995       1263   3.164  0.00169 ** 

  anxiety_dose_volume_of_mimosa_lesions_by_sex_gam <- gam(volume_of_mimosa_lesions ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxiety_dose_volume_of_mimosa_lesions_by_sex_gam)
  
```

### Uncinate **ACNP**

#### Demographics
```{r demo_uncinate}


###### all groups, no unclassified
make_demographics_table_ms_anxiety_simple(df_demo_and_fascicles %>% filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified"))

###### just healthy and sick
make_demographics_table_ms_anxiety_simple(df_demo_and_fascicles %>% filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "Has.Anxietydx.OR.Antianxiety.Meds"))

```
#### Uncinate by diagnosis 
```{r uncinate_by_dx}

#### Fx = F gives better results than FX = T

### Results:  
#define group
  df_empi_dx_network_proportions <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "Has.Anxietydx.OR.Antianxiety.Meds") %>%
  mutate(subject = as.factor(EMPI)) %>%
  mutate(Diagnosis = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  mutate(Diagnosis = ifelse(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy", "MS-Anxiety", "MS+Anxiety")) %>%
  mutate(Diagnosis = as.factor(Diagnosis)) %>%
  dplyr::select(subject, osex, Diagnosis, PAT_AGE_AT_EXAM, UF_R_vol, UF_L_vol, F_R_vol, F_L_vol, mean_UF_vol) %>%
  ungroup() #n=122
 

#do lm UF*Diagnosis
 #UF_R_vol -> DiagnosisMS+Anxiety  1019.03     535.20   1.904   0.0593 .  
disease_UF_R_vol_lm <- lm(UF_R_vol ~ Diagnosis + osex + PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_UF_R_vol_lm)

 #UF_L_vol ->DiagnosisMS+Anxiety   729.21     389.80   1.871  0.06386 .    
disease_UF_L_vol_lm <- lm(UF_L_vol ~ Diagnosis + osex+PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_UF_L_vol_lm)

#bilat: DiagnosisMS+Anxiety   874.12     412.30   2.120   0.0361 * 
disease_mean_UF_vol_lm <- lm(mean_UF_vol ~ Diagnosis + osex+PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_mean_UF_vol_lm)


#gam, Fx= F
#UF_R_vol -> DiagnosisMS+Anxiety  1019.03     535.20   1.904   0.0593 .   
disease_UF_R_vol_gam <- gam(UF_R_vol ~ Diagnosis + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data = df_empi_dx_network_proportions)
summary(disease_UF_R_vol_gam)

 #UF_L_vol -> DiagnosisMS+Anxiety    675.7      381.3   1.772    0.079 .  
disease_UF_L_vol_gam <- gam(UF_L_vol ~ Diagnosis + osex+s(PAT_AGE_AT_EXAM, k = 4, fx = F), data = df_empi_dx_network_proportions)
summary(disease_UF_L_vol_gam)

#bilateral UF: DiagnosisMS+Anxiety    866.7      411.9   2.104   0.0375 *  
disease_mean_UF_vol_gam <- gam(mean_UF_vol ~ Diagnosis + osex+s(PAT_AGE_AT_EXAM, k = 4, fx = F), data = df_empi_dx_network_proportions)
summary(disease_mean_UF_vol_gam)

```

#### Uncinate by Anxiety Dose 
```{r uncinateByAnxietyDose}

#### Fx = F gives better results than FX = T
#results: Anxiety dose related to UF_R when covarying for linear effects of age and sex, just barely
# Additionally - taking the mean of both UF and UR, LM for bilat anxiety dose + sex + age: anxiety_dose most sig P= 0.0367 *  (fx=T)

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != -1) #n=371

#lm

  #R anxiety dose + age ; anxiety_dose      430.81     240.44   1.792    0.074 .   
  anxietyGrouping_UF_R_lm <- lm(UF_R_vol ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_R_lm)

   #R *anxiety dose + osex + age anxiety_dose:       anxiety_dose      440.30     241.07   1.826   0.0686 .  
  anxietyGrouping_UF_R_by_sex_lm <- lm(UF_R_vol ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_R_by_sex_lm)
  
   #UF L - anxiety_dose + age:    anxiety_dose     337.695    169.917   1.987   0.0476 *  
  anxietyGrouping_UF_L_lm <- lm(UF_L_vol ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_L_lm)
  
   #UF_L anxiety_dose + sex + age:         anxiety_dose     350.563    170.099   2.061    0.040 *    
  anxietyGrouping_UF_L_by_sex_lm <- lm(UF_L_vol ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_L_by_sex_lm)
  
  #bilat anxiety dose + age: anxiety_dose     anxiety_dose     384.254    185.461   2.072    0.039 *
  anxietyGrouping_mean_UF_lm <- lm(mean_UF_vol ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_UF_lm)
  
  #bilat anxiety dose + sex + age: anxiety_dose     395.432    185.804   2.128    0.034 *  
  anxietyGrouping_mean_UF_by_sex_lm <- lm(mean_UF_vol ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_UF_by_sex_lm)

  
  
 
#gam, Fx=F - k = 4 and 5 give the same stats
  
  #UF _ R  anxiety_dose    430.3      240.4    1.79   0.0742 .  
  anxietyGrouping_UF_R_gam <- gam(UF_R_vol ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_R_gam)
  
 #R anxiety dose + sex + age: anxiety_dose    439.8      241.0   1.825   0.0689 .  

    anxietyGrouping_UF_R_by_sex_gam <- gam(UF_R_vol ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_R_by_sex_gam)
  
   #UF_L, anxiety_dose + age: anxiety_dose    337.8      169.8    1.99   0.0473 *  
  anxietyGrouping_UF_L_gam <- gam(UF_L_vol ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_L_gam)
  
   #UF_L anxiety_dose + sex + age: anxiety_dose    350.5      170.0   2.062   0.0399 *    
  anxietyGrouping_UF_L_by_sex_gam <- gam(UF_L_vol ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_UF_L_by_sex_gam)
  
  #bilat
  
  #bilat  anxiety_dose + age: anxiety_dose    383.7      185.3   2.071   0.0391 *  
  anxietyGrouping_mean_UF_gam <- gam(mean_UF_vol ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_UF_gam)
  
 #bilat anxiety dose + sex + age: anxiety_dose    394.7      185.7   2.126   0.0342 * 

    anxietyGrouping_mean_UF_by_sex_gam <- gam(mean_UF_vol ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = F), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_mean_UF_by_sex_gam)
```

##### Laterality in uncinate
```{r laterality}
  #laterality 
  #overall - t = -8.1948, df = 660.22, p-value = 1.304e-15
  right_vs_left_uncinate <- t.test(df_demo_and_fascicles_no_unclass_anxiety_dose$UF_L_vol, df_demo_and_fascicles_no_unclass_anxiety_dose$UF_R_vol)
  print(right_vs_left_uncinate)
  
  #healthy - t = -4.4646, df = 172.88, p-value = 1.443e-05
   right_vs_left_uncinate_healthy <- t.test(df_demo_and_fascicles_no_unclass_anxiety_dose$UF_L_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 0], df_demo_and_fascicles_no_unclass_anxiety_dose$UF_R_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 0])
  print(right_vs_left_uncinate_healthy)
  
  #anxietydx or meds -t = -6.517, df = 441.79, p-value = 1.96e-10
  right_vs_left_uncinate_anxiety_or_meds <- t.test(df_demo_and_fascicles_no_unclass_anxiety_dose$UF_L_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 1], df_demo_and_fascicles_no_unclass_anxiety_dose$UF_R_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 1])
  print(right_vs_left_uncinate_anxiety_or_meds)
  
  #anxious+meds,t = -2.2382, df = 40.97, p-value = 0.0307
   right_vs_left_uncinate_anxiety_and_meds <- t.test(df_demo_and_fascicles_no_unclass_anxiety_dose$UF_L_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 2], df_demo_and_fascicles_no_unclass_anxiety_dose$UF_R_vol[df_demo_and_fascicles_no_unclass_anxiety_dose$anxiety_dose == 2])
  print(right_vs_left_uncinate_anxiety_and_meds)
```

### Fornix by Anxiety Dose
```{r fornixByAnxietyDose}

#results: Anxiety dose NOT related to F_R when covarying for linear effects of age and sex, not in line with that one paper that found fornix differences

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != 3)


########UF R - just looking at fornix by anxiety dose -NS
  anxietyGrouping_F_R_lm <- lm(F_R_vol ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_R_lm)
  
  #gam, anxiety_dose    - NS
  anxietyGrouping_F_R_gam <- gam(F_R_vol ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_R_gam)
  
  #UF _ R anxiety_dose     - NS    
  anxietyGrouping_F_R_by_sex_lm <- lm(F_R_vol ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_R_by_sex_lm)
  
  #gam, anxiety_dose  - NS 
    anxietyGrouping_F_R_by_sex_gam <- gam(F_R_vol ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_R_by_sex_gam)
  
  #UF L - anxiety_dose    - NS 
  anxietyGrouping_F_L_lm <- lm(F_L_vol ~ anxiety_dose + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_L_lm)
  
   #gam, anxiety_dose    - NS  
  anxietyGrouping_F_L_gam <- gam(F_L_vol ~ anxiety_dose + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_L_gam)
  
  #F_L anxiety_dose:NS        
  anxietyGrouping_F_L_by_sex_lm <- lm(F_L_vol ~ anxiety_dose + osex + PAT_AGE_AT_EXAM, data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_L_by_sex_lm)
  
   #gam, anxiety_dose - NS
  anxietyGrouping_F_L_by_sex_gam <- gam(F_L_vol ~ anxiety_dose + osex + s(PAT_AGE_AT_EXAM, k = 4, fx = T), data=df_demo_and_fascicles_no_unclass_anxiety_dose)
  summary(anxietyGrouping_F_L_by_sex_gam)
```

### Network*Diagnosis
```{r networkxdiagnosis_groups_collapse}  

## take home: comparing healthy to has anxiety AND meds, more disease within vs outside net, anxiety vs non, no interaction.
## take home #2 : More disease in R & L uncinate in anxious versus nonanxious

  #burden of anxiety by network
  #clean up data frame
  df_empi_dx_network_proportions <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "Has.Anxietydx.OR.Antianxiety.Meds") %>%
  mutate(subject = as.factor(EMPI)) %>%
  mutate(Diagnosis = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  mutate(Diagnosis = ifelse(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy", "MS-Anxiety", "MS+Anxiety")) %>%
  mutate(Diagnosis = as.factor(Diagnosis)) %>%
  mutate(Anxiety_network = proportion_volume_lost_anxiety_net_by_network_size_sum_top_25) %>%
  mutate(Nonanxiety_network = proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75) %>%
  dplyr::select(subject, osex, Diagnosis, Anxiety_network, Nonanxiety_network, PAT_AGE_AT_EXAM, UF_R_vol, UF_L_vol, F_R_vol, F_L_vol) %>% 
  gather(Network, proportion_affected, -subject, -Diagnosis, -PAT_AGE_AT_EXAM, -osex, -UF_R_vol, -UF_L_vol, -F_R_vol, -F_L_vol) %>% #this is like a melt. Keeps empi and depGroupVar out of the melt
  mutate(Network = as.factor(Network)) %>%
  ungroup() #n=244 (122 x 2)
 

#simple lmer

#NetworkNonanxiety_network                      -0.245959   0.009028 120.000000 -27.245  < 2e-16 ***
#DiagnosisMS+Anxiety                             0.143579   0.045316 132.184401   3.168  0.00190 ** 

disease_within_vs_outside_anxiety_net_by_dx_groups_lmer <- lmer(proportion_affected ~ Network*Diagnosis + (1|subject) + PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_within_vs_outside_anxiety_net_by_dx_groups_lmer)

#Network confit:
confint(disease_within_vs_outside_anxiety_net_by_dx_groups_lmer)

#simple lmer
#NetworkNonanxiety_network         -0.247316   0.009473 120.000000 -26.107  < 2e-16 ***
  disease_within_vs_outside_anxiety_net_by_sex_diff_lmer <- lmer(proportion_affected ~ Network*osex + (1|subject) + PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
  summary(disease_within_vs_outside_anxiety_net_by_sex_diff_lmer)

#Network confit:
confint(disease_within_vs_outside_anxiety_net_by_sex_diff_lmer)

## diagnosis by sex 
 #simple lmer, DiagnosisMS+Anxiety         0.148038   0.045605   3.246 0.001337 ** 
disease_diagnosis_by_sex_diff_lm <- lm(proportion_affected ~ Diagnosis*osex+ PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_diagnosis_by_sex_diff_lm)

#Network confit:
confint(disease_diagnosis_by_sex_diff_lm)

#network * diagnosis + sex
#NetworkNonanxiety_network                      -0.245959   0.009028 120.000001 -27.245  < 2e-16 ***
#DiagnosisMS+Anxiety                             0.143161   0.045499 130.966650   3.146  0.00205 ** 
disease_within_vs_outside_anxiety_net_by_dx_groups_sex_diff_lmer <- lmer(proportion_affected ~ Network*Diagnosis + osex + (1|subject)+ PAT_AGE_AT_EXAM, data = df_empi_dx_network_proportions)
summary(disease_within_vs_outside_anxiety_net_by_dx_groups_sex_diff_lmer)

#Confit
confint(disease_within_vs_outside_anxiety_net_by_dx_groups_sex_diff_lmer)

```

### Diag Effect Size * Fascicle anxiety net overlap (from depression analysis) - NOT SIG both vol and prop, only vol shown here
```{r dxEffSizeOverlapwithAnxietyNet}

#tried looking at prop instead of volume - opposite effects of depression. Higher effect sizes -> lower overlap with anxiety net

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  mutate(anxiousAndMeds_or_healthy = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  filter(anxiousAndMeds_or_healthy %in% c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")) %>%
    mutate(anxiousAndMeds_or_healthy = ordered(anxiousAndMeds_or_healthy)) #n=122

#  mutate(anxiousAndMeds_or_healthy = factor(anxiousAndMeds_or_healthy, levels=c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))


#Positive Ts are places where anxious people have more disease than controls
fascicle_anxiety_vs_healthy_effsize <- sapply(fascicle_names_w_vol_suffix, function(fascicle) 
{

  text_for_eval <- paste0("rstatix::wilcox_effsize(df_demo_and_fascicles_no_unclass_anxiety_dose, formula = ", fascicle, " ~ anxiousAndMeds_or_healthy, paired = F, conf.level = 0.95, ci.type = \"perc\", nboot = 1000)$effsize")
  eval(parse(text=text_for_eval))
})
names(fascicle_anxiety_vs_healthy_effsize) <- fascicle_names_w_vol_suffix

#convert to data frame
df_effsize_values <- as.data.frame(fascicle_anxiety_vs_healthy_effsize)

#write.table(x = df_effsize_values, file = paste0(homedir, "results/fascicle_and_wilcox_effect_size_for_volxdx_analysis_n77.csv"), row.names = T, col.names = F, quote = F, sep = ",")


```

#### Plot effect size x Anxiety net overlap - N.S. (including if I drop all fascicles with no overlap)
``` {r plot_scatter}
#######################
### plot differences ##
#######################

#combine data frames, column 1 has names of fascicles, column 2 has Volume of overlap with anxiety network, column 3 has t-test value of anxiety vs healthy unc, 4th anxiety vs healthy fdr corrected within that fascicle

df_fascicle_anxiety_mask_volume_overlap_effsize_value <- data.frame(neurosynth_anxiety_network_fascicle_overlap$fascicle, neurosynth_anxiety_network_fascicle_overlap$non_zero_voxels_in_anxiety_map, df_effsize_values)
names(df_fascicle_anxiety_mask_volume_overlap_effsize_value) <- c("fascicle", "volume_in_anxiety_mask", "anxiety_vs_healthy_effsize")

#remove values that have no overlap
df_fascicle_anxiety_mask_volume_overlap_effsize_value <- df_fascicle_anxiety_mask_volume_overlap_effsize_value %>% filter(volume_in_anxiety_mask > 0)

# plot fascicle overlap x Eff size value
#statistic, 

anxiety_overlap_x_anxiety_vs_healthy_vol_effsize <- lm(anxiety_vs_healthy_effsize ~ volume_in_anxiety_mask, data=df_fascicle_anxiety_mask_volume_overlap_effsize_value )
summary(anxiety_overlap_x_anxiety_vs_healthy_vol_effsize)


scatter_effsize_val_by_anxiety_net_overlap_log <- ggplot(data=df_fascicle_anxiety_mask_volume_overlap_effsize_value, aes(x=volume_in_anxiety_mask, y=anxiety_vs_healthy_effsize, color=anxiety_vs_healthy_effsize)) +
  geom_point(size=2) + 
  scale_color_gradient(low = "#FFFFFF", high = "#ff00ff") +
  geom_smooth(formula = y ~ x, method=lm, color="black")+
  scale_x_continuous(trans=scales::pseudo_log_trans(base = 10), breaks=c(0, 10, 100, 1000, 10000, 100000)) + 
  xlab("Volume of Fascicle in Anxiety Network") + 
  ylab("Effect Size (r)") + 
  theme(plot.title=element_text(hjust=0.5),
        axis.text = element_text(size=16, color = "black"),
        axis.title = element_text(size=18, color = "black"),
        axis.line = element_line(color="black", size=1.3),
        panel.background = element_blank(),
        legend.position = "none",
        aspect.ratio = 4/4) + 
  annotate("text", x=1.6, y=0.14, size = 5, 
           label = paste0("P = ", round(summary(anxiety_overlap_x_anxiety_vs_healthy_vol_effsize)$coef[2,4],2))) 

print(scatter_effsize_val_by_anxiety_net_overlap_log)

#save as pdf
#pdf(file=paste0(homedir, "/results/Figures_for_msanxietyn_paper/scatter_effsize_val_by_anxiety_net_overlap_log.pdf"))
 # scatter_effsize_val_by_anxiety_net_overlap_log
#dev.off()

#df_for_making_colors <- df_fascicle_anxiety_mask_volume_overlap_effsize_value %>% dplyr::select(fascicle, anxiety_vs_healthy_effsize)
#write.table(x = df_for_making_colors, file = paste0(homedir, "results/fascicle_and_effect_size_for_volxdx_analysis_n77.csv"), row.names = F, col.names = F, quote = F, sep = ",")

```

### Sex Differences
```{r diseaseXsexdiff}
############## sex diff
#df_anxiety_disorder_by_sex <- 

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter (anxiety_dose != -1) #n=371


###### Sex differences - NONE. important because anxiety dx usually have differences

## in anxiety diagnosis

#####FIRST, SEX DIFF IN FREQUENCY OF ILLNESS - no diff between groups

#first number is # with anxiety, second is number without anxiety
anxiety_female_0 <-df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 0 & osex == "Female") %>% count()
anxiety_total_0 <-df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 0) %>% count()
anxiety_female_1 <-df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 1 & osex == "Female") %>% count()
anxiety_total_1 <-df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 1) %>% count()
anxiety_female_2 <- df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 2 & osex == "Female") %>% count()
anxiety_total_2 <- df_demo_and_fascicles_no_unclass_anxiety_dose %>% filter(anxiety_dose == 2) %>% count()

#make table
num_w_anxiety_female <- as.numeric(c(anxiety_female_0, anxiety_female_1, anxiety_female_2))
num_total <-as.numeric(c(anxiety_total_0,anxiety_total_1, anxiety_total_2))
df_2x3_anxiety_score_by_total_people_per_diagnosis <- data.frame(cbind(num_w_anxiety_female, num_total), row.names = c("MS+AnxietyandMed", "MS+AnxietyorMed", "MS-Anxiety"))

#X-squared (Pearson's) X-squared = 0.23427, df = 2, p-value = 0.8895
chisq_anxiety_dose <- chisq.test(df_2x3_anxiety_score_by_total_people_per_diagnosis)
chisq_anxiety_dose

#just healthy and super anxious/sick, X-squared = 0, df = 1, p-value = 1
num_w_anxiety_female_just_healthy_and_sick <- as.numeric(c(anxiety_female_0, anxiety_female_2))
num_total_just_healthy_and_sick <-as.numeric(c(anxiety_total_0,anxiety_total_2))
df_2x2_anxiety_score_by_total_people_per_diagnosis_num_total_just_healthy_and_sick <- data.frame(cbind(num_w_anxiety_female_just_healthy_and_sick, num_total_just_healthy_and_sick), row.names = c("MS+AnxietyandMed", "MS-Anxiety"))

chisq_healthy_vs_sick <- chisq.test(df_2x2_anxiety_score_by_total_people_per_diagnosis_num_total_just_healthy_and_sick)
chisq_healthy_vs_sick





#frequency_diff_between_sexes <- chisq.test(df_demo_and_fascicles$Has.Anxietydx.AND.Antianxietymed, df_demo_and_fascicles$osex)

#simple lmer across whole network

#overall - NS
disease_between_sexes <- lm(proportion_volume_lost_per_total_network_size_sum ~ osex+ PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(disease_between_sexes)

### anxiety net NS
disease_between_sexes_anxiety_net <- lm(proportion_volume_lost_anxiety_net_by_network_size_sum ~ osex+ PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(disease_between_sexes_anxiety_net)

### nonanxiety net - NS
disease_between_sexes_nonanxiety_net <- lm(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ osex+ PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(disease_between_sexes_nonanxiety_net)

#uncinate R- NS
disease_between_sexes_UF_R <- lm(UF_R_vol ~ osex+ PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(disease_between_sexes_UF_R)

#uncinate L - ns
disease_between_sexes_UF_L <- lm(UF_L_vol ~ osex+ PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(disease_between_sexes_UF_L)

```

### Age*Disease

#### Anxiety diagnosis
```{r anxiety_dx_x_age}

#purpose of this analysis is to evaluate the relationship between disease (cross sectional) by diagnosis as well as by anxiety dose
#hypothesize that anxiety vs nonanxiety will have worse disease overall, and that this may be related to anxiety dose
#start by defining new variables and a new data frame that contains anxiety dose (as factor and as ordinal), as well as diagnosis (no anxiety vs severe anxiety)

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != -1) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose)) %>%
  mutate(Diagnosis = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  mutate(Diagnosis = ifelse(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy", "MS-Anxiety", "MS+Anxiety")) %>%
  mutate(Diagnosis = as.factor(Diagnosis)) #n=371


### diagnosis by age interaction?
#overall - NS for diagnosis
diagnosis_by_age <- lm(proportion_volume_lost_per_total_network_size_sum ~ Diagnosis*PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(diagnosis_by_age)

#gam diagnosis - SPLINE SIGNIFICANT
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.579  1.927 5.027  0.0138 * 
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 1.988  2.379 5.205  0.0033 **
diagnosis_by_age_gam <- gam(proportion_volume_lost_per_total_network_size_sum ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_gam)
summary(diagnosis_by_age_gam)$s.table


#plot proportion_volume_lost_per_total_network_size_sum
plot_smooths_proportion_volume_lost_per_total_network_size_sum <- plot_smooths(
  model = diagnosis_by_age_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_proportion_volume_lost_per_total_network_size_sum

####. within/outside anxiety network #######
#diagnosis
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.05  1.099 5.539 0.01921 * 
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 1.74  2.115 5.257 0.00473 **
diagnosis_by_age_anx_net_gam <- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_anx_net_gam)
summary(diagnosis_by_age_anx_net_gam)$s.table
#plot(diagnosis_by_age_anx_net_gam)


#gam plot diagnosis_by_age_anx_net_gam_factor

plot_smooths_diagnosis_by_age_anx_net_gam_factor <- plot_smooths(
  model = diagnosis_by_age_anx_net_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_diagnosis_by_age_anx_net_gam_factor


##### #outside each network
#diagnosis: MS+Anxiety p=0.0432
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.975  2.373 4.660 0.00556 **
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 2.157  2.543 5.059 0.00282 **
diagnosis_by_age_nonanx_net_gam <- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_nonanx_net_gam)
summary(diagnosis_by_age_nonanx_net_gam)$s.table
#plot(diagnosis_by_age_nonanx_net_gam)


#gam plot diagnosis_by_age_nonanx_net_gam_factor

plot_smooths_diagnosis_by_age_nonanx_net_gam_factor <- plot_smooths(
  model = diagnosis_by_age_nonanx_net_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_diagnosis_by_age_nonanx_net_gam_factor


### uncinate right
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.001  1.003 24.11 2.01e-06 ***
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 1.059  1.116 15.01 0.000105 ***

diagnosis_by_age_UF_R_gam <- gam(UF_R_vol ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_R_gam)
summary(diagnosis_by_age_UF_R_gam)$s.table
#plot(diagnosis_by_age_UF_R_gam)



#gam UF_R plot

plot_smooths_anxiety_diagnosis_by_age_UF_R <- plot_smooths(
  model = diagnosis_by_age_UF_R_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_anxiety_diagnosis_by_age_UF_R

#uncinate left
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.930  2.328  7.546 0.00046 ***
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 1.001  1.002 10.868 0.00107 ** 

diagnosis_by_age_UF_L_gam <- gam(UF_L_vol ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_L_gam)
summary(diagnosis_by_age_UF_L_gam)$s.table
#plot(diagnosis_by_age_UF_L_gam)



#gam UF_L plot

plot_smooths_anxiety_diagnosis_by_age_UF_L <- plot_smooths(
  model = diagnosis_by_age_UF_L_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_anxiety_diagnosis_by_age_UF_L


#uncinate mean
#s(PAT_AGE_AT_EXAM):DiagnosisMS-Anxiety 1.006  1.013 23.95 2.10e-06 ***
#s(PAT_AGE_AT_EXAM):DiagnosisMS+Anxiety 1.000  1.000 17.02 4.59e-05 ***

diagnosis_by_age_mean_UF_gam <- gam(mean_UF_vol ~ Diagnosis+s(PAT_AGE_AT_EXAM, by = Diagnosis, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_mean_UF_gam)
summary(diagnosis_by_age_mean_UF_gam)$s.table
#plot(diagnosis_by_age_UF_L_gam)



#gam UF mean plot

plot_smooths_anxiety_diagnosis_by_age_mean_UF_vol <- plot_smooths(
  model = diagnosis_by_age_mean_UF_gam,
  series = PAT_AGE_AT_EXAM,
  comparison = Diagnosis
) +
  theme(legend.position = "top")
plot_smooths_anxiety_diagnosis_by_age_mean_UF_vol


## Sex diff trajectories by age
#overall - NS
sex_by_age <- lm(proportion_volume_lost_per_total_network_size_sum ~ osex*PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(sex_by_age)




```

#### Anxiety DOSE -> NEED TO UPDATE stats in text
```{r anxietydosexage}

#purpose of this analysis is to evaluate the relationship between disease (cross sectional) by diagnosis as well as by anxiety dose
#hypothesize that anxiety vs nonanxiety will have worse disease overall, and that this may be related to anxiety dose
#start by defining new variables and a new data frame that contains anxiety dose (as factor and as ordinal), as well as diagnosis (no anxiety vs severe anxiety)

#define group
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != 3) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose)) %>%
  mutate(Diagnosis = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  mutate(Diagnosis = ifelse(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy", "MS-Anxiety", "MS+Anxiety")) %>%
  mutate(Diagnosis = as.factor(Diagnosis)) 


### diagnosis by age interaction?
#overall - NS
diagnosis_by_age <- lm(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose*PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(diagnosis_by_age)

#gam dose
diagnosis_by_age_gam <- gam(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_gam)
summary(diagnosis_by_age_gam)$s.table
#plot(diagnosis_by_age_gam)

#gam factor - there is a linear dose effect per network size sum, as well as a sig age by anxiety relationship, but only in sick people
diagnosis_by_age_gam_factor <- gam(proportion_volume_lost_per_total_network_size_sum ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_gam_factor)
summary(diagnosis_by_age_gam_factor)$s.table
#plot(diagnosis_by_age_gam_factor)

#plot proportion_volume_lost_per_total_network_size_sum
plot_smooths_proportion_volume_lost_per_total_network_size_sum <- plot_smooths(
  model = diagnosis_by_age_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_proportion_volume_lost_per_total_network_size_sum

####. within/outside anxiety network #######
#dose
diagnosis_by_age_anx_net_gam <- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_anx_net_gam)
summary(diagnosis_by_age_anx_net_gam)$s.table
#plot(diagnosis_by_age_anx_net_gam)

#factor
diagnosis_by_age_anx_net_gam_factor <- gam(proportion_volume_lost_anxiety_net_by_network_size_sum_top_25 ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_anx_net_gam_factor)
summary(diagnosis_by_age_anx_net_gam_factor)$s.table
#plot(diagnosis_by_age_anx_net_gam_factor)

#gam plot diagnosis_by_age_anx_net_gam_factor

plot_smooths_diagnosis_by_age_anx_net_gam_factor <- plot_smooths(
  model = diagnosis_by_age_anx_net_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_diagnosis_by_age_anx_net_gam_factor


##### #outside each network

##dose
diagnosis_by_age_nonanx_net_gam <- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_nonanx_net_gam)
summary(diagnosis_by_age_nonanx_net_gam)$s.table
#plot(diagnosis_by_age_nonanx_net_gam)

#factor

diagnosis_by_age_nonanx_net_gam_factor <- gam(proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75 ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_nonanx_net_gam_factor)
summary(diagnosis_by_age_nonanx_net_gam_factor)$s.table
#plot(diagnosis_by_age_nonanx_net_gam_factor)

#gam plot diagnosis_by_age_nonanx_net_gam_factor

plot_smooths_diagnosis_by_age_nonanx_net_gam_factor <- plot_smooths(
  model = diagnosis_by_age_nonanx_net_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_diagnosis_by_age_nonanx_net_gam_factor


### uncinate right

#dose
diagnosis_by_age_UF_R_gam <- gam(UF_R_vol ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_R_gam)
summary(diagnosis_by_age_UF_R_gam)$s.table
#plot(diagnosis_by_age_UF_R_gam)

#factor
diagnosis_by_age_UF_R_gam_factor <- gam(UF_R_vol ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_R_gam_factor)
summary(diagnosis_by_age_UF_R_gam_factor)$s.table
#plot(diagnosis_by_age_UF_R_gam_factor)

#gam UF_R plot

plot_smooths_anxiety_dose_by_age_UF_R <- plot_smooths(
  model = diagnosis_by_age_UF_R_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_anxiety_dose_by_age_UF_R

#uncinate left
#dose
diagnosis_by_age_UF_L_gam <- gam(UF_L_vol ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_L_gam)
summary(diagnosis_by_age_UF_L_gam)$s.table
#plot(diagnosis_by_age_UF_L_gam)

#factor
diagnosis_by_age_UF_L_gam_factor <- gam(UF_L_vol ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_UF_L_gam_factor)
summary(diagnosis_by_age_UF_L_gam_factor)$s.table
#plot(diagnosis_by_age_UF_L_gam_factor)

#gam UF_L plot

plot_smooths_anxiety_dose_by_age_UF_L <- plot_smooths(
  model = diagnosis_by_age_UF_L_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_anxiety_dose_by_age_UF_L


#uncinate mean
#dose


diagnosis_by_age_mean_UF_gam <- gam(mean_UF_vol ~ anxiety_dose+s(PAT_AGE_AT_EXAM, by = anxiety_dose, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_mean_UF_gam)
summary(diagnosis_by_age_mean_UF_gam)$s.table

#factor
diagnosis_by_age_mean_UF_gam_factor <- gam(mean_UF_vol ~ anxiety_dose_factor+s(PAT_AGE_AT_EXAM, by = anxiety_dose_factor, k=4, fx = F), data = df_demo_and_fascicles_no_unclass_anxiety_dose, method = "REML")
summary(diagnosis_by_age_mean_UF_gam_factor)
summary(diagnosis_by_age_mean_UF_gam_factor)$s.table
#plot(diagnosis_by_age_UF_L_gam_factor)

#gam mean

plot_smooths_anxiety_dose_by_age_mean_UF_factor <- plot_smooths(
  model = diagnosis_by_age_mean_UF_gam_factor,
  series = PAT_AGE_AT_EXAM,
  comparison = anxiety_dose_factor
) +
  theme(legend.position = "top")
plot_smooths_anxiety_dose_by_age_mean_UF_factor

## Sex diff trajectories by age
#overall - NS
sex_by_age <- lm(proportion_volume_lost_per_total_network_size_sum ~ osex*PAT_AGE_AT_EXAM, data = df_demo_and_fascicles_no_unclass_anxiety_dose)
summary(sex_by_age)




```



### Individual Fascicle disease

#### healthy vs super sick - values that fdr correct, most not anxiety net
```{r individual_fascicle_disease_healthy_vs_super_sick}
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  mutate(anxiousAndMeds_or_healthy = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  filter(anxiousAndMeds_or_healthy %in% c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")) %>%
  mutate(anxiousAndMeds_or_healthy = factor(anxiousAndMeds_or_healthy, levels=c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

#lm
fascicle_lm <- lapply(fascicle_names_w_prop_suffix, function(x) 
{
  lm(substitute(i ~ anxiousAndMeds_or_healthy + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- fascicle_names_w_prop_suffix

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)

#fdr corrected only association cortex
#fascicle_anova_w_fiber_mapping <- fascicle_agesex_anova[which(fascicle_bundle_mapping$name_vector == "association")]
##fascicle_anova_fdr_association <- fdr_anova_generic(fascicle_anova_w_fiber_mapping,1)
#print(fascicle_anova_fdr_association)

#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```

#### Parametric all fascicles
```{r individual_fascicle_disease_anxiety_dose}

### 3 meet FDR - C_FPH_R_prop	0.037			C_FP_R_prop	0.042			DRTT_R_prop	0.042
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != 3) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose))

#lm
fascicle_lm <- lapply(fascicle_names_w_prop_suffix, function(x) 
{
  lm(substitute(i ~ oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- fascicle_names_w_prop_suffix

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)

#fdr corrected only association cortex
#fascicle_anova_w_fiber_mapping <- fascicle_agesex_anova[which(fascicle_bundle_mapping$name_vector == "association")]
##fascicle_anova_fdr_association <- fdr_anova_generic(fascicle_anova_w_fiber_mapping,1)
#print(fascicle_anova_fdr_association)

#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```
#### Parametric anxiety net fascicles
```{r indiv_fascicle_anxiety_net_anxiety_dose}

## 3 meet FDR - EMC_L_prop	0.0320914948			C_PHP_R_prop	0.0265819790			C_FPH_R_prop	0.0004861282	
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != -1) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose))

#lm
fascicle_lm <- lapply(fascicle_names_top_25_prop_w_suff, function(x) 
{
  lm(substitute(i ~ oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- fascicle_names_top_25_prop_w_suff

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)

#fdr corrected only association cortex
#fascicle_anova_w_fiber_mapping <- fascicle_agesex_anova[which(fascicle_bundle_mapping$name_vector == "association")]
##fascicle_anova_fdr_association <- fdr_anova_generic(fascicle_anova_w_fiber_mapping,1)
#print(fascicle_anova_fdr_association)

#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```

#### Parametric nonanxiety net fascicles
```{r nonanxiety_net_anxiety_dose}

# 2 FDR corr sig: C_FP_R_prop	0.048			DRTT_R_prop	0.048

df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != -1) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose))

#lm
fascicle_lm <- lapply(fascicle_names_bottom_75_prop_w_suff, function(x) 
{
  lm(substitute(i ~ oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- fascicle_names_bottom_75_prop_w_suff

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)

#fdr corrected only association cortex
#fascicle_anova_w_fiber_mapping <- fascicle_agesex_anova[which(fascicle_bundle_mapping$name_vector == "association")]
##fascicle_anova_fdr_association <- fdr_anova_generic(fascicle_anova_w_fiber_mapping,1)
#print(fascicle_anova_fdr_association)

#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```

### Plots 

##### Overall disease, within and outside anxiety net
```{r}
#n = 371
prop_injured_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x= oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed , y=proportion_volume_lost_per_total_network_size_sum, fill= oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed )) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_by_anxiety_burden_collapsed_vars_plot

  #proportion injured over anxiety net
prop_injured_anxiety_net_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=proportion_volume_lost_anxiety_net_by_network_size_sum_top_25, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_anxiety_net_by_anxiety_burden_collapsed_vars_plot

  #proportion injured over nonanxiety net
prop_injured_nonanxiety_net_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_nonanxiety_net_by_anxiety_burden_collapsed_vars_plot
```

##### Plots Uncinate R& L Prop
```{r plots_uncinate}
  #proportion injured over R Uncinate prop
#n=371
prop_injured_R_uncinate_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=UF_R_prop, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_R_uncinate_by_anxiety_burden_collapsed_vars_plot

 #proportion injured over R Uncinate prop - geom_bar
means_by_anxiety_dose <- c(mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxietydx.OR.Antianxiety.Meds"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"]))

df_UF_R_mean_by_anxiety_dose <- data.frame(cbind(means_by_anxiety_dose, c("true_healthy", "Has.Anxietydx.OR.Antianxiety.Meds", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

names(df_UF_R_mean_by_anxiety_dose) <- c("mean_UF_R", "Anxiety_dose")

df_UF_R_mean_by_anxiety_dose <- df_UF_R_mean_by_anxiety_dose %>%
  mutate(mean_UF_R = as.numeric(mean_UF_R)) %>%
  mutate(Anxiety_dose = factor(Anxiety_dose, levels = unique(Anxiety_dose)))
                        
prop_injured_R_uncinate_by_anxiety_burden_collapsed_vars_plot_bar <-  ggplot(df_UF_R_mean_by_anxiety_dose, aes(x=Anxiety_dose, y=mean_UF_R, fill=Anxiety_dose)) +
  geom_bar(stat="identity") +  
  ylim(0,0.5)+
#  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5),
        panel.background = element_rect(colour = "white", fill = "white"))
prop_injured_R_uncinate_by_anxiety_burden_collapsed_vars_plot_bar


  #proportion injured over L Uncinate prop
prop_injured_L_uncinate_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=UF_L_prop, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_L_uncinate_by_anxiety_burden_collapsed_vars_plot



 #proportion injured over R Uncinate prop - geom_bar
means_by_anxiety_dose <- c(mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_L_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_L_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxietydx.OR.Antianxiety.Meds"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$UF_L_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"]))

df_UF_L_mean_by_anxiety_dose <- data.frame(cbind(means_by_anxiety_dose, c("true_healthy", "Has.Anxietydx.OR.Antianxiety.Meds", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

names(df_UF_L_mean_by_anxiety_dose) <- c("mean_UF_L", "Anxiety_dose")

df_UF_R_mean_by_anxiety_dose <- df_UF_L_mean_by_anxiety_dose %>%
  mutate(mean_UF_L = as.numeric(mean_UF_L)) %>%
  mutate(Anxiety_dose = factor(Anxiety_dose, levels = unique(Anxiety_dose)))
                        
prop_injured_L_uncinate_by_anxiety_burden_collapsed_vars_plot_bar <-  ggplot(df_UF_R_mean_by_anxiety_dose, aes(x=Anxiety_dose, y=mean_UF_L, fill=Anxiety_dose)) +
  geom_bar(stat="identity") +  
  ylim(0,0.5)+
#  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5),
        panel.background = element_rect(colour = "white", fill = "white"))
prop_injured_L_uncinate_by_anxiety_burden_collapsed_vars_plot_bar
```

##### Plots C_FPH_R_prop	0.037			C_FP_R_prop	0.042			DRTT_R_prop	0.042

```{r plots_areas_that_FDR_correct}
 
#n=371

df_disease_burden_unc_and_anx_net_collapsed_variables <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>% 
  dplyr::select(proportion_volume_lost_per_total_network_size_sum, proportion_volume_lost_anxiety_net_by_network_size_sum_top_25, proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75, C_FPH_R_prop, C_FP_R_prop,DRTT_R_prop, oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, osex)


 #proportion injured over C_FPH_R_prop
prop_injured_C_FPH_R_prop_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=C_FPH_R_prop, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_C_FPH_R_prop_by_anxiety_burden_collapsed_vars_plot

 #proportion injured over C_FPH_R_prop - geom_bar
means_by_anxiety_dose <- c(mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FPH_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FPH_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxietydx.OR.Antianxiety.Meds"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FPH_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"]))

df_C_FPH_R_prop_mean_by_anxiety_dose <- data.frame(cbind(means_by_anxiety_dose, c("true_healthy", "Has.Anxietydx.OR.Antianxiety.Meds", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

names(df_C_FPH_R_prop_mean_by_anxiety_dose) <- c("C_FPH_R_prop", "Anxiety_dose")

df_C_FPH_R_prop_mean_by_anxiety_dose <- df_C_FPH_R_prop_mean_by_anxiety_dose %>%
  mutate(mean_C_FPH_R_prop = as.numeric(C_FPH_R_prop)) %>%
  mutate(Anxiety_dose = factor(Anxiety_dose, levels = unique(Anxiety_dose)))
                        
prop_injured_C_FPH_R_prop_by_anxiety_burden_collapsed_vars_plot_bar <-  ggplot(df_C_FPH_R_prop_mean_by_anxiety_dose, aes(x=Anxiety_dose, y=mean_C_FPH_R_prop, fill=Anxiety_dose)) +
  geom_bar(stat="identity") +  
  ylim(0,1)+
#  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5),
        panel.background = element_rect(colour = "white", fill = "white"))
prop_injured_C_FPH_R_prop_by_anxiety_burden_collapsed_vars_plot_bar


 #proportion injured over C_FP_R_prop
prop_injured_C_FP_R_prop_prop_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=C_FP_R_prop, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_C_FP_R_prop_prop_by_anxiety_burden_collapsed_vars_plot

 #proportion injured over C_FP_R_prop - geom_bar
means_by_anxiety_dose <- c(mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FP_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FP_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxietydx.OR.Antianxiety.Meds"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$C_FP_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"]))

df_C_FP_R_prop_mean_by_anxiety_dose <- data.frame(cbind(means_by_anxiety_dose, c("true_healthy", "Has.Anxietydx.OR.Antianxiety.Meds", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

names(df_C_FP_R_prop_mean_by_anxiety_dose) <- c("C_FP_R_prop", "Anxiety_dose")

df_C_FP_R_prop_mean_by_anxiety_dose <- df_C_FP_R_prop_mean_by_anxiety_dose %>%
  mutate(mean_C_FP_R_prop = as.numeric(C_FP_R_prop)) %>%
  mutate(Anxiety_dose = factor(Anxiety_dose, levels = unique(Anxiety_dose)))
                        
prop_injured_C_FP_R_prop_by_anxiety_burden_collapsed_vars_plot_bar <-  ggplot(df_C_FP_R_prop_mean_by_anxiety_dose, aes(x=Anxiety_dose, y=mean_C_FP_R_prop, fill=Anxiety_dose)) +
  geom_bar(stat="identity") +  
  ylim(0,1)+
#  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5),
        panel.background = element_rect(colour = "white", fill = "white"))
prop_injured_C_FP_R_prop_by_anxiety_burden_collapsed_vars_plot_bar




 #proportion injured over DRTT_R_prop
prop_injured_DRTT_R_prop_prop_by_anxiety_burden_collapsed_vars_plot <-  ggplot(df_disease_burden_unc_and_anx_net_collapsed_variables, aes(x=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed, y=DRTT_R_prop, fill=oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5))
prop_injured_DRTT_R_prop_prop_by_anxiety_burden_collapsed_vars_plot

 #proportion injured over DRTT_R_prop - geom_bar
means_by_anxiety_dose <- c(mean(df_disease_burden_unc_and_anx_net_collapsed_variables$DRTT_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="true_healthy"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$DRTT_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxietydx.OR.Antianxiety.Meds"]),
                                mean(df_disease_burden_unc_and_anx_net_collapsed_variables$DRTT_R_prop[df_disease_burden_unc_and_anx_net_collapsed_variables$oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed=="Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"]))

df_DRTT_R_prop_mean_by_anxiety_dose <- data.frame(cbind(means_by_anxiety_dose, c("true_healthy", "Has.Anxietydx.OR.Antianxiety.Meds", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")))

names(df_DRTT_R_prop_mean_by_anxiety_dose) <- c("DRTT_R_prop", "Anxiety_dose")

df_DRTT_R_prop_mean_by_anxiety_dose <- df_DRTT_R_prop_mean_by_anxiety_dose %>%
  mutate(mean_DRTT_R_prop = as.numeric(DRTT_R_prop)) %>%
  mutate(Anxiety_dose = factor(Anxiety_dose, levels = unique(Anxiety_dose)))
                        
prop_injured_DRTT_R_prop_by_anxiety_burden_collapsed_vars_plot_bar <-  ggplot(df_DRTT_R_prop_mean_by_anxiety_dose, aes(x=Anxiety_dose, y=mean_DRTT_R_prop, fill=Anxiety_dose)) +
  geom_bar(stat="identity") +  
  ylim(0,1)+
#  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  theme(axis.text.x = element_text(size=8, angle = 45, vjust = 0.5),
        panel.background = element_rect(colour = "white", fill = "white"))
prop_injured_C_FP_R_prop_by_anxiety_burden_collapsed_vars_plot_bar


```


##Plot within vs outside network
```{r plottting_bar_graph}

#Within vs outside network
anxiety_net_group <- c(rep("Anxiety Network", times = dim(df_demo_and_fascicles)[1]), rep("Nonanxiety Network",times =dim(df_demo_and_fascicles)[1]))
net_values <- c(df_demo_and_fascicles$proportion_volume_lost_anxiety_net_by_network_size_sum_top_25, df_demo_and_fascicles$proportion_volume_lost_nonanxiety_net_by_network_size_sum_bottom_75)

newdf <- data.frame(anxiety_net_group, net_values)

newdf <- newdf %>%
  mutate( anxiety_net_group=factor(anxiety_net_group,levels=c( "Nonanxiety Network", "Anxiety Network")))

violin_within_vs_outside_network_sum_proportion_scaled_by_network_size <- ggplot(newdf, aes(x=anxiety_net_group, y=net_values, fill=anxiety_net_group)) +
  geom_violin() +  
  geom_boxplot(width=0.1, color="black", fill="white", outlier.size = 0.2) + 
  ggtitle(paste0("Volume of Fascicle Disease Burden")) +
  ylab("Proportion of network affected") +
  ylim(0,1) + 
  scale_fill_manual(values=c("#D3D3D3", "#841DE2")) +
  theme(plot.title = element_text(size=16, hjust = 0.55),
        axis.text = element_text(size = 16, colour = "black"), axis.title.y  = element_blank(), 
        axis.title.x = element_text(size=16),
        axis.line = element_line(size = 1.5, colour = "black", linetype=1),
        legend.position = "none",
        aspect.ratio=4/7,
        panel.background = element_rect(colour = "white", fill = "white")) + 
  coord_flip() 

#display
violin_within_vs_outside_network_sum_proportion_scaled_by_network_size
```
### Yeo networks
#### healthy vs super sick 
```{r individual_fascicle_disease_healthy_vs_super_sick_yeo}

## all correct
df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  mutate(anxiousAndMeds_or_healthy = oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed) %>%
  filter(anxiousAndMeds_or_healthy %in% c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep")) %>%
  mutate(anxiousAndMeds_or_healthy = factor(anxiousAndMeds_or_healthy, levels=c("true_healthy", "Has.Anxiety.And.On.Anxiety.Meds.Inc.Dep"))) #n=122

#lm
fascicle_lm <- lapply(yeo_network_names_prop, function(x) 
{
  lm(substitute(i ~ anxiousAndMeds_or_healthy + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- yeo_network_names_prop

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)

#fdr corrected only association cortex
#fascicle_anova_w_fiber_mapping <- fascicle_agesex_anova[which(fascicle_bundle_mapping$name_vector == "association")]
##fascicle_anova_fdr_association <- fdr_anova_generic(fascicle_anova_w_fiber_mapping,1)
#print(fascicle_anova_fdr_association)

#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```

#### Parametric yeo networks
```{r individual_fascicle_disease_anxiety_dose_yeo}
#n=371, all correct

df_demo_and_fascicles_no_unclass_anxiety_dose <- df_demo_and_fascicles %>%
  filter(oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed != "unclassified") %>%
  filter(anxiety_dose != -1) %>%
  mutate(anxiety_dose_factor = ordered(anxiety_dose))

#lm
fascicle_lm <- lapply(yeo_network_names_prop, function(x) 
{
  lm(substitute(i ~ oanxietydx_OR_meds_AND_Anxietydx.Meds.And.Dep.True.Healthy.Collapsed + PAT_AGE_AT_EXAM, list(i = as.name(x))), data = df_demo_and_fascicles_no_unclass_anxiety_dose)
})
names(fascicle_lm) <- yeo_network_names_prop

#anova
fascicle_anova <- lapply(fascicle_lm, anova)


#fdr corrected
fascicle_anova_fdr <- fdr_anova_generic(fascicle_anova, 1)
print(fascicle_anova_fdr)


#uncorrected
fascicle_anova_p <- sapply(fascicle_anova, function(v) v$"Pr(>F)"[1])
fascicle_anova_p05_unc <- as.data.frame(fascicle_anova_p[fascicle_anova_p < 0.05])
print(fascicle_anova_p05_unc) 
```


